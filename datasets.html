<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VacSol-ML Dataset Browser</title>

  <!-- DataTables CSS -->
  <link rel="stylesheet"
        href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <!-- DataTables JS -->
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

  <!-- PapaParse -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
    }

    h1 {
      margin-bottom: 5px;
    }

    p {
      max-width: 900px;
    }

    select {
      padding: 6px;
      margin-bottom: 15px;
    }

    a.download-btn {
      display: inline-block;
      margin-bottom: 15px;
      padding: 8px 12px;
      background: #2c7be5;
      color: white;
      text-decoration: none;
      border-radius: 4px;
    }

    a.download-btn:hover {
      background: #1a5dcc;
    }

    table.dataTable {
      font-size: 12px;
    }
  </style>
</head>

<body>

  <h1>VacSol-ML Dataset Browser</h1>
  <p>
    Interactive exploration of VacSol-ML machine-learning ready datasets
    containing sequence-derived features and immunological prediction scores.
  </p>

  <label for="datasetSelect"><strong>Select Dataset:</strong></label><br>
  <select id="datasetSelect">
    <option value="VacSol-ML Dataset.csv">
      VacSol-ML Dataset (Processed)
    </option>
    <option value="VacSol-ML_DataSet_new_original.csv">
      VacSol-ML Dataset (Original)
    </option>
  </select>

  <br>

  <a id="downloadBtn"
     class="download-btn"
     href="VacSol-ML Dataset.csv"
     download>
     â¬‡ Download Selected Dataset
  </a>

  <hr>

  <table id="datasetTable" class="display" style="width:100%"></table>

<script>
let table = null;

function loadDataset(file) {

  // Destroy previous table if exists
  if (table) {
    table.destroy();
    $('#datasetTable').empty();
  }

  Papa.parse(file, {
    download: true,
    header: true,
    skipEmptyLines: true,

    complete: function(results) {

      // Get true header fields
      const columnNames = results.meta.fields;

      // Build DataTables column definitions
      const columns = columnNames.map(col => ({
        title: col,
        data: col,
        defaultContent: ""
      }));

      // Normalize rows (force every key to exist)
      const normalizedData = results.data.map(row => {
        let cleanRow = {};
        columnNames.forEach(col => {
          cleanRow[col] = row[col] ?? "";
        });
        return cleanRow;
      });

      // Initialize DataTable
      table = $('#datasetTable').DataTable({
        data: normalizedData,
        columns: columns,
        scrollX: true,
        pageLength: 10,
        deferRender: true,
        processing: true,
        stateSave: true
      });
    }
  });

  // Update download link
  document.getElementById("downloadBtn").href = file;
}

// Load default dataset on page load
loadDataset("VacSol-ML Dataset.csv");

// Handle dataset switching
document.getElementById("datasetSelect").addEventListener("change", function() {
  loadDataset(this.value);
});
</script>

</body>
</html>
