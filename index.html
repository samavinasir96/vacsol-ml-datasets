<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VacSol-ML Interactive Visualizations</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.plot.ly/plotly-2.35.2.min.css">
    <style>body { font-family: Arial, sans-serif; margin: 20px; } .chart-container { height: 500px; margin: 20px 0; } .tab-pane { padding: 20px; }</style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">VacSol-ML Datasets: Interactive Visualizations</h1>
        <p class="text-center">Explore ESKAPE protein features. Hover for Protein_ID details; zoom/pan freely.</p>
        <ul class="nav nav-tabs" id="vizTabs" role="tablist">
            <li class="nav-item"><button class="nav-link active" id="tab1-viz" data-bs-toggle="tab" data-bs-target="#tab1" type="button">Dataset 1: Lags (362 Proteins)</button></li>
            <li class="nav-item"><button class="nav-link" id="tab2-viz" data-bs-toggle="tab" data-bs-target="#tab2" type="button">Dataset 2: Physicochem (412 Proteins)</button></li>
        </ul>
        <div class="tab-content" id="vizTabsContent">
            <div class="tab-pane fade show active" id="tab1" role="tabpanel">
                <p><a href="VacSol-ML Dataset.csv" download>Download CSV</a></p>
                <div id="box1" class="chart-container"></div>
                <div id="scatter1" class="chart-container"></div>
                <div id="hist1" class="chart-container"></div>
            </div>
            <div class="tab-pane fade" id="tab2" role="tabpanel">
                <p><a href="VacSol-ML_DataSet_new_original.csv" download>Download CSV</a></p>
                <div id="scatter2" class="chart-container"></div>
                <div id="box2" class="chart-container"></div>
                <div id="hist2" class="chart-container"></div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script>
        $(document).ready(function() {
            function loadAndViz(csvFile, vizConfig) {
                Papa.parse(csvFile, { download: true, header: true, dynamicTyping: true, complete: function(results) {
                    if (results.errors.length > 0) { console.error('CSV Errors:', results.errors); return; }
                    const data = results.data;
                    vizConfig.forEach(config => {
                        const trace = config.trace(data);
                        const layout = { title: config.title, hovermode: 'closest', width: '100%', height: 500 };
                        Plotly.newPlot(config.div, [trace], layout);
                    });
                }});
            }
            // Dataset 1
            loadAndViz('VacSol-ML Dataset.csv', [
                { div: 'box1', title: 'Lag Distributions by Organism (Lags 1-5)', trace: (data) => ({
                    y: ['CIDH920105.lag1', 'CIDH920105.lag2', 'CIDH920105.lag3', 'CIDH920105.lag4', 'CIDH920105.lag5'].map(col => data.map(row => row[col] || 0)),
                    x: data.map(row => row.Organism),
                    type: 'box', orientation: 'h',
                    hovertemplate: '<b>%{x}</b><br>Lag: %{fullData.name}<br>Value: %{y}<br>Protein: %{text}<extra></extra>',
                    text: data.map(row => row.Protein_ID)
                })},
                { div: 'scatter1', title: 'Antigenicity vs B-Cell Score (by Organism)', trace: (data) => ({
                    x: data.map(row => row.antigenicity_1 || 0),
                    y: data.map(row => row.b_cells_probability_score || 0),
                    mode: 'markers', type: 'scatter',
                    marker: { color: data.map(row => row.Organism), size: 8, colorscale: 'Viridis' },
                    text: data.map(row => row.Protein_ID),
                    hovertemplate: '<b>%{text}</b><br>Antigen: %{x}<br>B-Cell: %{y}<br>Org: %{marker.color}<extra></extra>'
                })},
                { div: 'hist1', title: 'Final Predictions', trace: (data) => ({
                    x: data.map(row => row.Final_predictions || 0),
                    type: 'histogram', nbinsx: 2,
                    hovertemplate: 'Pred: %{x}<br>Count: %{y}<extra></extra>'
                })}
            ]);
            // Dataset 2
            loadAndViz('VacSol-ML_DataSet_new_original.csv', [
                { div: 'scatter2', title: 'MW vs Antigenicity (Bubble: aa_no)', trace: (data) => ({
                    x: data.map(row => row.molecular_weight || 0),
                    y: data.map(row => row.antigenicity_1 || 0),
                    mode: 'markers', type: 'scatter',
                    marker: { size: data.map(row => (row.aa_no || 0) / 10), color: 'blue', sizemin: 4 },
                    text: data.map(row => row.Protein_ID),
                    hovertemplate: '<b>%{text}</b><br>MW: %{x}<br>Antigen: %{y}<br>aa_no: %{marker.size * 10}<extra></extra>'
                })},
                { div: 'box2', title: 'Hydropathy by Instability Bins', trace: (data) => {
                    const bins = ['Low (<40)', 'Med (40-60)', 'High (>60)'];
                    const yData = bins.map(bin => {
                        const binData = data.filter(row => {
                            const inst = row.instability_index || 0;
                            if (bin === 'Low (<40)') return inst < 40;
                            if (bin === 'Med (40-60)') return inst >= 40 && inst <= 60;
                            return inst > 60;
                        }).map(row => row.Hydropathy_gravy || 0);
                        return binData;
                    });
                    return { y: yData, x: bins, type: 'box', orientation: 'h', hovertemplate: '<b>%{x}</b><br>Hydropathy: %{y}<extra></extra>' };
                }},
                { div: 'hist2', title: 'pH Charge Distribution', trace: (data) => ({
                    x: data.map(row => row.pH_charge || 0),
                    type: 'histogram', nbinsx: 20,
                    hovertemplate: 'pH: %{x}<br>Count: %{y}<extra></extra>'
                })}
            ]);
        });
    </script>
</body>
</html>
