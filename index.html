<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>VacSol-ML Datasets — Interactive Visualizer</title>

  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#9aa7bf;
      --accent:#6ee7b7;
      --glass: rgba(255,255,255,0.03);
      --radius:12px;
      font-family: Inter, system-ui, -apple-system, BlinkMacSystemFont;
    }
    html,body{
      margin:0;
      background:linear-gradient(180deg,#071024,#071a2a);
      color:#e6eef8
    }
    .container{
      display:grid;
      grid-template-columns:320px 1fr;
      gap:20px;
      padding:28px;
      max-width:1400px;
      margin:auto
    }
    header{
      grid-column:1/-1;
      display:flex;
      justify-content:space-between;
      align-items:center;
      background:rgba(255,255,255,0.03);
      padding:18px;
      border-radius:12px
    }
    h1{font-size:18px;margin:0}
    .muted{color:var(--muted);font-size:13px}
    .sidebar{
      background:var(--card);
      padding:18px;
      border-radius:12px;
      height:calc(100vh - 140px);
      overflow:auto
    }
    .main{
      background:var(--glass);
      padding:18px;
      border-radius:12px
    }
    label{font-size:13px;color:var(--muted);margin-top:12px;display:block}
    select,button{
      width:100%;
      padding:10px;
      margin-top:6px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.05);
      background:transparent;
      color:white
    }
    button{
      background:linear-gradient(180deg,#0b6b4f,#0a5f48);
      color:#04150f;
      font-weight:600;
      cursor:pointer
    }
    .download a{
      display:block;
      text-align:center;
      margin-top:8px;
      padding:10px;
      border-radius:8px;
      background:#0b6b4f;
      color:#04150f;
      text-decoration:none;
      font-weight:600
    }
    .chart-area{height:75vh}
    .footer{
      grid-column:1/-1;
      text-align:center;
      font-size:13px;
      color:var(--muted)
    }
    @media(max-width:900px){
      .container{grid-template-columns:1fr}
      .sidebar{height:auto}
    }
  </style>

  <script src="https://cdn.plot.ly/plotly-2.26.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>

<body>
<div class="container">

<header>
  <div>
    <h1>VacSol-ML Dataset Visualizer</h1>
    <div class="muted">Explore physicochemical and immunogenic features across pathogens</div>
  </div>
  <div class="muted">Plotly • CSV • GitHub Pages</div>
</header>

<aside class="sidebar">
  <label>Dataset</label>
  <select id="datasetSelect">
    <option value="orig">VacSol-ML Dataset</option>
    <option value="new">VacSol-ML_DataSet_new_original</option>
  </select>

  <label>Feature group</label>
  <select id="groupSelect" disabled></select>

  <label>Organism / Pathogen</label>
  <select id="organismSelect">
    <option value="all">All organisms</option>
  </select>

  <button id="showAggregate">Show aggregate view</button>

  <div class="download">
    <a id="downloadOrig" target="_blank">Download time-series CSV</a>
    <a id="downloadNew" target="_blank">Download features CSV</a>
  </div>

  <div class="muted" style="margin-top:14px">
    Select an organism to explore feature distributions across its proteins.
  </div>
</aside>

<main class="main">
  <div class="muted" id="subtitle">Load a dataset to begin</div>
  <div id="chart" class="chart-area"></div>
</main>

<div class="footer">
  VacSol-ML • <a href="https://github.com/samavinasir96/vacsol-ml-datasets" target="_blank" style="color:var(--accent)">GitHub Repository</a>
</div>

</div>

<script>
const RAW = {
  orig:'https://raw.githubusercontent.com/samavinasir96/vacsol-ml-datasets/main/VacSol-ML%20Dataset.csv',
  new:'https://raw.githubusercontent.com/samavinasir96/vacsol-ml-datasets/main/VacSol-ML_DataSet_new_original.csv'
};

document.getElementById('downloadOrig').href = RAW.orig;
document.getElementById('downloadNew').href = RAW.new;

let state = {data:[], columns:[], organismCol:null};
const datasetSelect = document.getElementById('datasetSelect');
const groupSelect = document.getElementById('groupSelect');
const organismSelect = document.getElementById('organismSelect');
const chartDiv = document.getElementById('chart');
const subtitle = document.getElementById('subtitle');

function detectOrganismColumn(cols){
  return cols.find(c => /organism|pathogen|species|strain/i.test(c));
}

function detectGroups(cols){
  return {
    "Physicochemical": cols.filter(c=>/molecular|weight|ph|hydropathy|instability|aromaticity/i.test(c)),
    "Immunogenic / MHC": cols.filter(c=>/mhc|antigen|epitope|rank|prob/i.test(c)),
    "Time-series (lag)": cols.filter(c=>/lag/i.test(c))
  };
}

function loadDataset(key){
  Papa.parse(RAW[key],{
    download:true,
    header:true,
    dynamicTyping:true,
    complete: res => {
      state.data = res.data;
      state.columns = res.meta.fields;
      state.organismCol = detectOrganismColumn(state.columns);
      populateGroups();
      populateOrganisms();
      renderAggregate();
    }
  });
}

function populateGroups(){
  const groups = detectGroups(state.columns);
  groupSelect.innerHTML='';
  Object.keys(groups).forEach(g=>{
    const o=document.createElement('option');
    o.value=g; o.textContent=g;
    groupSelect.appendChild(o);
  });
  groupSelect.disabled=false;
}

function populateOrganisms(){
  organismSelect.innerHTML='<option value="all">All organisms</option>';
  if(!state.organismCol) return;
  [...new Set(state.data.map(r=>r[state.organismCol]).filter(Boolean))]
    .sort()
    .forEach(o=>{
      const opt=document.createElement('option');
      opt.value=o; opt.textContent=o;
      organismSelect.appendChild(opt);
    });
}

function filteredData(){
  if(organismSelect.value==='all' || !state.organismCol) return state.data;
  return state.data.filter(r=>r[state.organismCol]===organismSelect.value);
}

function renderAggregate(){
  const group = groupSelect.value;
  const cols = detectGroups(state.columns)[group] || [];
  const traces = cols.map(c=>{
    const vals = filteredData().map(r=>r[c]).filter(v=>typeof v==='number');
    return {y:vals,type:'box',name:c,boxmean:true};
  });
  subtitle.textContent = organismSelect.value==='all'
    ? `Aggregate view across all organisms`
    : `Aggregate view — ${organismSelect.value}`;
  Plotly.newPlot(chartDiv,traces,{
    margin:{t:40,l:70,r:20,b:140},
    paper_bgcolor:'rgba(0,0,0,0)',
    plot_bgcolor:'rgba(255,255,255,0.02)',
    showlegend:false
  },{responsive:true});
}

datasetSelect.onchange=()=>loadDataset(datasetSelect.value);
groupSelect.onchange=renderAggregate;
organismSelect.onchange=renderAggregate;
document.getElementById('showAggregate').onclick=renderAggregate;

loadDataset('orig');
</script>
</body>
</html>
